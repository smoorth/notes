
# SQL Performance Tuning DMV Cheat Sheet

| **Category**             | **MSSQL (SQL Server)**                                             | **PSQL (PostgreSQL)**                                                | **Description**                                                                                                |
|--------------------------|--------------------------------------------------------------------|----------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------|
| **Wait Stats**            | `sys.dm_os_wait_stats`                                            | `pg_stat_activity`                                                   | Provides information on waits encountered by threads in SQL Server and PostgreSQL.                             |
|                          | `sys.dm_exec_requests`                                            | `pg_stat_activity`                                                   | Shows currently executing requests along with associated waits.                                                |
| **I/O Usage**             | `sys.dm_io_virtual_file_stats`                                    | `pg_stat_database`                                                   | Displays I/O statistics for each database file (per file).                                                     |
|                          | `sys.dm_exec_query_stats`                                         | `pg_stat_statements` (Extension)                                     | Tracks I/O and execution stats per query.                                                                      |
| **Index/Cache Usage**     | `sys.dm_db_index_usage_stats`                                     | `pg_stat_user_indexes`                                               | Shows index usage statistics, such as reads and writes.                                                       |
|                          | `sys.dm_exec_cached_plans`                                        | `pg_stat_statements` (Extension)                                     | Provides info about cached query plans (for re-use).                                                           |
| **CPU Usage**             | `sys.dm_exec_query_stats`                                         | `pg_stat_statements` (Extension)                                     | Displays aggregate query CPU and execution stats, by query hash.                                               |
|                          | `sys.dm_os_schedulers`                                            | `pg_stat_activity`                                                   | Displays CPU scheduler usage, with information about workload distribution across CPUs.                        |
| **Memory Usage**          | `sys.dm_os_memory_clerks`                                         | `pg_stat_activity`, `pg_stat_database_conflicts`                     | Shows memory allocations by various memory clerks (SQL Server components).                                     |
|                          | `sys.dm_exec_memory_grants`                                       | `pg_stat_activity`                                                   | Displays memory grants (for queries) and their statuses.                                                       |
| **Blocking/Locks**        | `sys.dm_tran_locks`                                               | `pg_locks`                                                           | Shows lock requests and details about what is being blocked (e.g., tables, pages).                             |
|                          | `sys.dm_exec_sessions`                                            | `pg_stat_activity`                                                   | Provides information about active sessions, such as wait types, blocking status, etc.                          |
| **Bottlenecks**           | `sys.dm_os_waiting_tasks`                                         | `pg_locks`, `pg_stat_activity`                                       | Shows tasks currently waiting on resources (for example, lock waits).                                          |
|                          | `sys.dm_exec_query_stats`, `sys.dm_exec_query_plan_stats`          | `pg_stat_statements` (Extension)                                     | Provides query-level statistics, including execution time, I/O, and CPU (potential bottlenecks).               |
| **Execution Plans**       | `sys.dm_exec_query_plan`                                          | `EXPLAIN`, `EXPLAIN ANALYZE`                                         | Provides the query execution plan for currently running or cached queries.                                     |
| **Database/Session Stats**| `sys.dm_exec_sessions`                                            | `pg_stat_activity`                                                   | Shows info about active sessions, including user activity and database interactions.                           |
|                          | `sys.dm_exec_connections`                                         | `pg_stat_activity`                                                   | Provides info about open connections and network-related stats (bytes sent/received).                          |
| **TempDB Usage**          | `sys.dm_db_file_space_usage` (for TempDB)                         | `pg_stat_database` (temp files related)                              | Monitors TempDB usage and space consumption, which is crucial for identifying bottlenecks related to TempDB.    |
| **Query Store**           | Query Store DMVs (`sys.query_store_runtime_stats`, etc.)          | `pg_stat_statements` (Extension)                                     | Query Store (SQL Server) and pg_stat_statements (PostgreSQL) are used to track query performance over time.    |
| **Disk IO Waits**         | `sys.dm_io_virtual_file_stats`, `sys.dm_os_wait_stats`            | `pg_stat_io` (from pg_stat_statements)                               | Helps to track and identify disk I/O waits and bottlenecks.                                                    |
| **Buffer Pool Usage**     | `sys.dm_os_buffer_descriptors`, `sys.dm_os_memory_cache_entries`  | `pg_buffercache` (Extension)                                         | Shows the distribution of pages in the buffer pool, helping to identify memory usage and cache efficiency.     |

## Notes

- **MSSQL** uses DMVs (Dynamic Management Views) extensively for performance tuning. These are system views that provide real-time information about the internal workings of the SQL Server engine.
- **PSQL** relies more on system views like `pg_stat_*` and requires extensions like `pg_stat_statements` for deeper query tracking.
- PostgreSQL has some features that are not available natively in SQL Server (e.g., detailed buffer cache monitoring), but many advanced features require enabling extensions.
